name: åŒæ­¥ Awesome GitHub Copilot æª”æ¡ˆ

on:
  schedule:
    # æ¯å¤© UTC 00:00 åŸ·è¡Œ (å°åŒ—æ™‚é–“æ—©ä¸Š 8:00)
    - cron: '0 0 * * *'
  workflow_dispatch: # å…è¨±æ‰‹å‹•è§¸ç™¼
    
jobs:
  sync-awesome-copilot:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      
    steps:
      - name: Checkout ç›®å‰çš„ repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: é…ç½® Git ä½¿ç”¨è€…è³‡è¨Š
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
      - name: å»ºç«‹è‡¨æ™‚ç›®éŒ„
        run: mkdir -p /tmp/awesome-copilot
        
      - name: Clone Awesome GitHub Copilot repository
        run: |
          git clone --depth 1 https://github.com/github/awesome-copilot.git /tmp/awesome-copilot
          
      - name: åŒæ­¥ chatmodes è³‡æ–™å¤¾
        run: |
          # ç§»é™¤èˆŠçš„è³‡æ–™å¤¾ä¸¦å»ºç«‹æ–°çš„
          rm -rf chatmodes
          mkdir -p chatmodes
          
          # è¤‡è£½æª”æ¡ˆ
          if [ -d "/tmp/awesome-copilot/chatmodes" ]; then
            cp -r /tmp/awesome-copilot/chatmodes/* chatmodes/
            echo "âœ… æˆåŠŸåŒæ­¥ chatmodes è³‡æ–™å¤¾"
          else
            echo "âš ï¸ ä¾†æº chatmodes è³‡æ–™å¤¾ä¸å­˜åœ¨"
          fi
          
      - name: åŒæ­¥ instructions è³‡æ–™å¤¾
        run: |
          # ç§»é™¤èˆŠçš„è³‡æ–™å¤¾ä¸¦å»ºç«‹æ–°çš„
          rm -rf instructions
          mkdir -p instructions
          
          # è¤‡è£½æª”æ¡ˆ
          if [ -d "/tmp/awesome-copilot/instructions" ]; then
            cp -r /tmp/awesome-copilot/instructions/* instructions/
            echo "âœ… æˆåŠŸåŒæ­¥ instructions è³‡æ–™å¤¾"
          else
            echo "âš ï¸ ä¾†æº instructions è³‡æ–™å¤¾ä¸å­˜åœ¨"
          fi
          
      - name: åŒæ­¥ prompts è³‡æ–™å¤¾
        run: |
          # ç§»é™¤èˆŠçš„è³‡æ–™å¤¾ä¸¦å»ºç«‹æ–°çš„
          rm -rf prompts
          mkdir -p prompts
          
          # è¤‡è£½æª”æ¡ˆ
          if [ -d "/tmp/awesome-copilot/prompts" ]; then
            cp -r /tmp/awesome-copilot/prompts/* prompts/
            echo "âœ… æˆåŠŸåŒæ­¥ prompts è³‡æ–™å¤¾"
          else
            echo "âš ï¸ ä¾†æº prompts è³‡æ–™å¤¾ä¸å­˜åœ¨"
          fi
          
      - name: æ¸…ç†è‡¨æ™‚æª”æ¡ˆ
        run: rm -rf /tmp/awesome-copilot
        
      - name: æª¢æŸ¥æ˜¯å¦æœ‰è®Šæ›´
        id: changes
        run: |
          git add .
          if git diff --staged --quiet; then
            echo "no_changes=true" >> $GITHUB_OUTPUT
            echo "ðŸ“ æ²’æœ‰æª”æ¡ˆè®Šæ›´"
          else
            echo "no_changes=false" >> $GITHUB_OUTPUT
            echo "ðŸ“ ç™¼ç¾æª”æ¡ˆè®Šæ›´"
            git status --porcelain
          fi
          
      - name: æäº¤ä¸¦æŽ¨é€è®Šæ›´
        if: steps.changes.outputs.no_changes == 'false'
        run: |
          git commit -m "ðŸ”„ è‡ªå‹•åŒæ­¥ Awesome GitHub Copilot æª”æ¡ˆ $(date +'%Y-%m-%d %H:%M:%S')"
          git push
          echo "ðŸš€ è®Šæ›´å·²æˆåŠŸæŽ¨é€"
          
      - name: é¡¯ç¤ºåŒæ­¥çµæžœ
        run: |
          echo "ðŸŽ‰ åŒæ­¥ä½œæ¥­å®Œæˆï¼"
          echo "ðŸ“Š æª”æ¡ˆçµ±è¨ˆï¼š"
          echo "   chatmodes: $(find chatmodes -name '*.md' 2>/dev/null | wc -l) å€‹æª”æ¡ˆ"
          echo "   instructions: $(find instructions -name '*.md' 2>/dev/null | wc -l) å€‹æª”æ¡ˆ"
          echo "   prompts: $(find prompts -name '*.md' 2>/dev/null | wc -l) å€‹æª”æ¡ˆ"